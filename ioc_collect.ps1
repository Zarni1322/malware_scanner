$WMI = Get-WmiObject Win32_Process

$outputFile = "process_hashes.txt"

# Open the file in append mode to save hash values
$writer = [System.IO.File]::AppendText($outputFile)

# Writing header to the file
$header = "pid Process name SHA-256"
$writer.WriteLine($header)
Write-Host $header

foreach ($process in $WMI) {
    $processId = $process.ProcessId
    $processName = $process.Name

    if ($process.ExecutablePath) {
        $content = [System.IO.File]::ReadAllBytes($process.ExecutablePath)
        $sha256 = [System.Security.Cryptography.SHA256]::Create()
        $hashBytes = $sha256.ComputeHash($content)
        $sha256Hash = [BitConverter]::ToString($hashBytes) -replace "-"

        $hashInfo = "{0,-10} {1,-30} {2}" -f $processId, $processName, $sha256Hash
        Write-Host $hashInfo
        $writer.WriteLine($hashInfo)
    } else {
        $hashInfo = "{0,-10} {1,-30} {2}" -f $processId, $processName, "N/A"
        Write-Host $hashInfo
        $writer.WriteLine($hashInfo)
    }
}

$writer.Close()

Write-Host "Hash values saved to $outputFile"
