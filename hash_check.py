import yara
import requests

# Replace with your VirusTotal API key
API_KEY = "40df563c477e7732629d1bdbb666894568c359ea9e0ec3af0f48639bfacdd3d1"

def get_virustotal_report(hash_value):
    url = f"https://www.virustotal.com/api/v3/files/{hash_value}"
    headers = {"x-apikey": API_KEY}
    response = requests.get(url, headers=headers)

    if response.status_code == 200:
        return response.json()
    else:
        return None

def main():
    # Receive Hash Value from User Input
    user_hash = input("Enter the hash value: ").strip().lower()

    # Load YARA rules from the .yar file
    yara_rules_file = "rules/yara/index.yar"
    compiled_rules = yara.compile(filepath=yara_rules_file)

    # Match the rules against the user-provided hash
    matches = compiled_rules.match(data=user_hash)

    if matches:
        print("YARA rule matched!")
        for match in matches:
            print("Rule Name:", match.rule)
            print("Meta Data:", match.meta)
            print("Tags:", match.tags)
            print("Namespace:", match.namespace)
            print("=" * 40)
        
        # Get VirusTotal report
        virustotal_report = get_virustotal_report(user_hash)
        if virustotal_report:
            print("VirusTotal Report:")
            print("SHA-256:", virustotal_report["data"]["attributes"]["sha256"])
            print("First Submission:", virustotal_report["data"]["attributes"]["first_submission_date"])
            print("Last Analysis:", virustotal_report["data"]["attributes"]["last_analysis_date"])
            print("Positives:", virustotal_report["data"]["attributes"]["last_analysis_stats"]["malicious"])
        else:
            print("VirusTotal report not available.")
    else:
        print("YARA rule did not match.")

if __name__ == "__main__":
    main()
