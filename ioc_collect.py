import wmi
import hashlib

# Initializing the wmi constructor
f = wmi.WMI()

# Create a text file to save the hash values
output_file = "process_hashes.txt"

# Open the file in append mode to save hash values
with open(output_file, "a") as file:
    # Iterating through all the running processes
    for process in f.Win32_Process():
        # Check if ExecutablePath is not None
        if process.ExecutablePath:
            # Calculate SHA-256 hash value
            with open(process.ExecutablePath, "rb") as exe_file:
                content = exe_file.read()
                sha256_hash = hashlib.sha256(content).hexdigest()
            file.write(f"{sha256_hash}\n")

print(f"SHA-256 hash values saved to {output_file}")